<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lume - Med Spa Client Retention</title>
    <meta name="description"
        content="AI-powered client retention platform for med spas. Predict churn, automate nudges, and grow your business.">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#00B8D9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lume">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Lume">
    <meta name="msapplication-TileColor" content="#0A2540">
    <meta name="msapplication-config" content="browserconfig.xml">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/clients.css">
    <link rel="stylesheet" href="css/analytics.css">
    <link rel="stylesheet" href="css/communications.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/operations.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/top-nav.css">
</head>

<body>
    <div id="app"></div>

    <!-- Services (load first) -->
    <script src="js/services/clientUtils.js"></script>
    <script src="js/services/csvParser.js"></script>
    <script src="js/services/marketBenchmarks.js"></script>
    <script src="js/services/advancedChurnCalculator.js"></script>
    <script src="js/services/churnAnalyzer.js"></script>
    <script src="js/services/nudgeGenerator.js"></script>
    <script src="js/services/clientDataService.js"></script>
    <script src="js/services/communicationService.js"></script>
    <script src="js/services/authService.js"></script>
    <script src="js/services/themeService.js"></script>
    <script src="js/services/exportService.js"></script>
    <script src="js/services/importService.js"></script>
    <script src="js/services/mfaService.js"></script>
    <script src="js/services/apiClient.js"></script>
    <script src="js/services/dashboardBuilder.js"></script>
    <script src="js/services/integrationsService.js"></script>

    <!-- Data -->
    <script src="js/data/clients.js"></script>
    <script src="js/data/metrics.js"></script>

    <!-- Components -->
    <script src="js/components/sidebar.js"></script>
    <script src="js/components/topNav.js"></script>
    <script src="js/components/header.js"></script>
    <script src="js/components/metricCard.js"></script>
    <script src="js/components/clientTable.js"></script>
    <script src="js/components/notificationCenter.js"></script>
    <script src="js/components/globalSearch.js"></script>
    <script src="js/pages/login.js"></script>
    <script src="js/pages/dashboard.js"></script>
    <script src="js/pages/clients.js"></script>
    <script src="js/pages/clientProfile.js"></script>
    <script src="js/pages/analytics.js"></script>
    <script src="js/pages/communications.js"></script>
    <script src="js/pages/settings.js"></script>
    <script src="js/pages/operations.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('âœ… Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('âŒ Service Worker registration failed:', error);
                    });
            });
        }

        // Handle Electron menu actions
        if (window.electronAPI) {
            window.electronAPI.onNavigate((path) => {
                window.location.hash = path;
            });

            window.electronAPI.onMenuAction((action) => {
                switch (action) {
                    case 'new-client':
                        // Open new client modal
                        break;
                    case 'send-nudge':
                        // Open nudge dialog
                        break;
                    case 'export-report':
                        // Export current view
                        break;
                }
            });

            console.log('âœ… Running in Electron Desktop');
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show install button if not in standalone mode
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                showInstallBanner();
            }
        });

        function showInstallBanner() {
            const banner = document.createElement('div');
            banner.id = 'pwa-install-banner';
            banner.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #0A2540 0%, #00B8D9 100%);
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                gap: 16px;
                z-index: 10000;
                font-family: Inter, sans-serif;
            `;
            banner.innerHTML = `
                <span>ðŸ“± Install Lume for a better experience</span>
                <button onclick="installPWA()" style="background: white; color: #0A2540; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600;">Install</button>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; opacity: 0.7; cursor: pointer; font-size: 18px;">Ã—</button>
            `;
            document.body.appendChild(banner);
        }

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('PWA Install:', outcome);
                deferredPrompt = null;
                document.getElementById('pwa-install-banner')?.remove();
            }
        }
    </script>
</body>

</html>